# OpenShift(OCP) 배포를 위한 Helm Values
# GHCR(GitHub Container Registry) 이미지 사용

global:
  # GHCR 이미지 레지스트리 설정
  imageRegistry: "ghcr.io/omg-dev-tech/workshop-eda"
  imageTag: "latest"
  
  # imagePullSecret 설정 (필요시 주석 해제)
  # GHCR이 public이면 불필요, private이면 아래 설정 필요
  # imagePullSecret: "ghcr-secret"
  imagePullSecret: ""
  
  # Kafka 부트스트랩 서버 (OCP 환경에 맞게 수정)
  kafkaBootstrap: "my-cluster-kafka-bootstrap:9092"

# 각 마이크로서비스 애플리케이션 설정
apps:
  order-service:
    containerPort: 8080
    service:
      port: 8081
    env:
      SPRING_DATASOURCE_URL: jdbc:postgresql://order-db:5432/orderdb
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres
      SPRING_KAFKA_BOOTSTRAP_SERVERS: my-cluster-kafka-bootstrap:9092
      EVENT_NS: orders.v1
      PAYMENT_SERVICE_URL: http://payment-adapter-ext:9090
      # OpenTelemetry 설정
      OTEL_EXPORTER_OTLP_ENDPOINT: ""
      INSTANA_API_KEY: ""

  inventory-service:
    containerPort: 8080
    service:
      port: 8082
    env:
      SPRING_DATASOURCE_URL: jdbc:postgresql://inventory-db:5432/inventorydb
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres
      SPRING_KAFKA_BOOTSTRAP_SERVERS: my-cluster-kafka-bootstrap:9092
      EVENT_NS: orders.v1

  fulfillment-service:
    containerPort: 8080
    service:
      port: 8083
    env:
      SPRING_DATASOURCE_URL: jdbc:postgresql://fulfillment-db:5432/fulfillmentdb
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres
      SPRING_KAFKA_BOOTSTRAP_SERVERS: my-cluster-kafka-bootstrap:9092
      EVENT_NS: orders.v1

  analytics-service:
    containerPort: 8084
    service:
      port: 8084
    env:
      SPRING_DATASOURCE_URL: jdbc:postgresql://analytics-db:5432/analyticsdb
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres
      SPRING_KAFKA_BOOTSTRAP_SERVERS: my-cluster-kafka-bootstrap:9092
      EVENT_NS: orders.v1

  payment-adapter-ext:
    containerPort: 9090
    service:
      port: 9090
    env:
      PAYMENT_SUCCESS_RATE: "0.9"
      PAYMENT_DELAY_MS: "500"

  api-gateway:
    containerPort: 8080
    service:
      port: 8080
    env:
      ORDER_SERVICE_URL: http://order-service:8081
      INVENTORY_SERVICE_URL: http://inventory-service:8082
      FULFILLMENT_SERVICE_URL: http://fulfillment-service:8083
      ANALYTICS_SERVICE_URL: http://analytics-service:8084
      CORS_ALLOWED_ORIGINS: "*"

  web:
    containerPort: 8080
    service:
      port: 80
    env:
      # API_GATEWAY_URL은 config.js에서 동적으로 생성됨
      # 로컬: localhost:8080
      # OCP: 브라우저 URL 기반 (web-xxx → api-gateway-xxx)
      API_GATEWAY_URL: http://api-gateway:8080  # 참고용 (실제로는 사용 안 함)
    # OCP Route 설정 (외부 접근용)
    route:
      enabled: true
      host: ""  # OCP에서 자동 생성되는 호스트 사용

# OCP 배포 참고사항:
# 1. Kafka, PostgreSQL 등 인프라 서비스는 별도로 배포 필요
# 2. Route를 통한 외부 노출이 필요한 경우 별도 설정 필요
# 3. ConfigMap/Secret으로 민감 정보 관리 권장
# 4. 리소스 제한은 templates/apps.yaml에 정의됨
# 5. Web UI는 Route를 통해 외부에서 접근 가능

# Made with Bob
